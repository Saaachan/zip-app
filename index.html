<!DOCTYPE html>
<html>
<head>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
<meta name="theme-color" content="#4f9fb8">
<meta charset="UTF-8">
<title>éƒµä¾¿ç•ªå·æ¤œç´¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap');

/* ===== ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ ===== */

:root {
  --bg: #f4f8fb;
  --text: #2f3a40;
  --title: #3e7c92;
  --accent: #4f9fb8;
  --card: #ffffff;
  --border: #e3f0f5;
  --input-border: #cfe3ea;
  --brown: #4a3f35;
  --toggle-bg: #ddeff5;
}

body.dark {
  --bg: #161c20;
  --text: #e6edf1;
  --title: #7cc3da;
  --accent: #3c8aa3;
  --card: #1f262b;
  --border: #2c3940;
  --input-border: #2c3940;
  --brown: #e6ded6;
  --toggle-bg: #2a3338;
}

/* ===== ãƒ™ãƒ¼ã‚¹ ===== */

body {
  font-family: 'Zen Maru Gothic', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 60px 20px;
  display: flex;
  justify-content: center;
  color: var(--text);
  transition: background 0.35s ease, color 0.35s ease;
}

.container {
  width: 100%;
  max-width: 500px;
}

/* ===== ã‚¿ã‚¤ãƒˆãƒ« ===== */

.title {
  text-align: center;
  font-size: 26px;
  font-weight: 700;
  color: var(--title);
  margin-bottom: 30px;
  letter-spacing: 1px;
}

/* ===== ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒˆã‚°ãƒ« ===== */

.toggle-wrapper {
  display: flex;
  justify-content: center;
  margin-bottom: 32px;
}

.toggle {
  width: 64px;
  height: 30px;
  background: var(--toggle-bg);
  border-radius: 999px;
  position: relative;
  cursor: pointer;
  transition: background 0.35s ease;
  border: 1px solid var(--border);
}

.toggle-circle {
  width: 26px;
  height: 26px;
  background: white;
  border-radius: 50%;
  position: absolute;
  top: 1.5px;
  left: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  transition: transform 0.35s ease;
}

body.dark .toggle-circle {
  transform: translateX(32px);
}

/* ===== å…¥åŠ› ===== */

input {
  width: 100%;
  padding: 16px;
  font-size: 16px;
  border-radius: 16px;
  border: 1px solid var(--input-border);
  background: var(--card);
  box-sizing: border-box;
  outline: none;
  color: var(--brown);
  font-family: 'Zen Maru Gothic', sans-serif;
  transition: 0.3s;
}

input::placeholder {
  color: #a08c7e;
}

/* ===== æ¤œç´¢ãƒœã‚¿ãƒ³ ===== */

.search-btn {
  margin-top: 20px;
  padding: 12px 28px;
  font-size: 17px;
  font-weight: 600;
  font-family: 'Zen Maru Gothic', sans-serif;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 999px;
  display: block;
  margin-left: auto;
  margin-right: auto;
  cursor: pointer;
  transition: opacity 0.2s ease;
}

.search-btn:hover {
  opacity: 0.85;
}

/* ===== ã‚«ãƒ¼ãƒ‰ ===== */

.card {
  background: var(--card);
  margin-top: 22px;
  padding: 22px;
  border-radius: 20px;
  border: 1px solid var(--border);
  transition: transform 0.25s ease;
}

.card:hover {
  transform: translateY(-4px);
}

.zip {
  font-weight: 700;
  font-size: 19px;
  margin-bottom: 6px;
  color: var(--title);
}

.address {
  color: var(--brown);
  font-weight: 500;
  font-size: 15px;
}
</style>
</head>

<body>
<div class="container">

<div class="title">
  ğŸ“®éƒµä¾¿ç•ªå·æ¤œç´¢ ğŸ’Œ
</div>

<div class="toggle-wrapper">
  <div class="toggle" onclick="toggleDarkMode()">
    <div class="toggle-circle" id="toggleIcon">ğŸŒ™</div>
  </div>
</div>

<input type="text" id="address" placeholder="ä¾‹ï¼šåå¤å±‹å¸‚ä¸­åŒº / å²¡å´å¸‚å¤§è¥¿">
<button class="search-btn" onclick="searchAddress()">æ¤œç´¢</button>

<div id="result"></div>

</div>

<script>

/* ===== ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ä¿å­˜å‡¦ç† ===== */

if (localStorage.getItem("theme") === "dark") {
  document.body.classList.add("dark");
}

updateIcon();

function toggleDarkMode() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");

  localStorage.setItem("theme", isDark ? "dark" : "light");
  updateIcon();
}

function updateIcon() {
  const icon = document.getElementById("toggleIcon");
  icon.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
}

/* ===== éƒµä¾¿ç•ªå·æ¤œç´¢ ===== */

let zipData = [];
let dataLoaded = false;

async function loadCSV() {
  const response = await fetch("utf_ken_all.csv");
  const text = await response.text();
  const lines = text.split("\n");

  zipData = lines
    .map(line => line.split(","))
    .filter(cols => cols.length > 8)
    .map(cols => ({
      zipcode: cols[2].replace(/"/g, ""),
      pref: cols[6].replace(/"/g, ""),
      city: cols[7].replace(/"/g, ""),
      town: cols[8].replace(/"/g, "")
    }));

  dataLoaded = true;
}

loadCSV();

function formatZip(zip) {
  return zip.length === 7 ? zip.slice(0,3) + "-" + zip.slice(3) : zip;
}

function searchAddress() {
  const input = document.getElementById("address").value.trim();
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "";

  if (!dataLoaded) {
    resultDiv.innerText = "ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­â€¦å°‘ã€…ãŠå¾…ã¡ãã ã•ã„";
    return;
  }

  if (!input) {
    resultDiv.innerText = "ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
    return;
  }

  const results = zipData
    .filter(item =>
      (item.pref + item.city + item.town).includes(input)
    )
    .slice(0, 20);

  if (results.length === 0) {
    resultDiv.innerText = "è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ";
    return;
  }

  results.forEach(item => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <div class="zip">ã€’${formatZip(item.zipcode)}</div>
      <div class="address">${item.pref}${item.city}${item.town}</div>
    `;

    div.onclick = () => {
      navigator.clipboard.writeText(formatZip(item.zipcode));
      alert("éƒµä¾¿ç•ªå·ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
    };

    resultDiv.appendChild(div);
  });
}
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>